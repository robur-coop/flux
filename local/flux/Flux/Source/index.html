<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Source (docs.local.flux.Flux.Source)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../../../index.html">Index</a> &#x00BB; <a href="../../../../index.html">docs</a> &#x00BB; <a href="../../../index.html">local</a> &#x00BB; <a href="../../index.html">flux</a> &#x00BB; <a href="../index.html">Flux</a> &#x00BB; Source</nav><header class="odoc-preamble"><h1>Module <code><span>Flux.Source</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#consuming-a-source.">Consuming a source.</a></li><li><a href="#resource-handling.">Resource handling.</a></li><li><a href="#miou-related-functions.">Miou related functions.</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec value anchored" id="val-unfold"><a href="#val-unfold" class="anchor"></a><code><span><span class="keyword">val</span> unfold : <span><span class="type-var">'s</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'s</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'s</span>)</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>unfold seed next</code> is a finite source created from a <code>seed</code> state and a function that produces elements and an updated state.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-empty"><a href="#val-empty" class="anchor"></a><code><span><span class="keyword">val</span> empty : <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p>An empty source.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-list"><a href="#val-list" class="anchor"></a><code><span><span class="keyword">val</span> list : <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>list items</code> is a source with all elements from the <code>items</code> list.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-seq"><a href="#val-seq" class="anchor"></a><code><span><span class="keyword">val</span> seq : <span><span><span class="type-var">'a</span> <a href="../../../../stdlib/Stdlib/Seq/index.html#type-t">Seq.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>seq items</code> is a source with all elements from the <code>items</code> sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-array"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span><span><span class="type-var">'a</span> array</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>array items</code> is a source with all elements from the <code>items</code> array.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <span class="arrow">&#45;&gt;</span></span> <span>char <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>string str</code> is a source with all characters from the <code>str</code> string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-queue"><a href="#val-queue" class="anchor"></a><code><span><span class="keyword">val</span> queue : <span><span><span class="type-var">'a</span> <a href="../../../../stdlib/Stdlib/Queue/index.html#type-t">Queue.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>queue q</code> is a source with all elements from the <code>q</code> queue.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bqueue"><a href="#val-bqueue" class="anchor"></a><code><span><span class="keyword">val</span> bqueue : 
  <span><span class="optlabel">?stop</span>:<span>[ `Ignore <span>| `Halt</span> <span>| `Close</span> ]</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="../Bqueue/index.html#type-t">Bqueue.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>bqueue ?stop q</code> is a source with all iterms from the <code>q</code> bounded-queue.</p><p>The user can choose how to <a href="#val-dispose"><code>dispose</code></a> the given bounded-queue <code>q</code>:</p><ul><li><code>`Ignore</code> does nothing</li><li><code>`Halt</code> <a href="../Bqueue/index.html#val-halt"><code>Bqueue.halt</code></a> the given bounded-queue <code>q</code></li><li><code>`Close</code> <a href="../Bqueue/index.html#val-close"><code>Bqueue.close</code></a> the given bounded-queue <code>q</code></li></ul><p><b>NOTE</b>: <code>`Halt</code> a bounded-queue created with <a href="../Bqueue/index.html#val-with_close"><code>Bqueue.with_close</code></a> also closes the given bounded-queue.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p>A source with all elements transformed with a mapping function.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-each"><a href="#val-each" class="anchor"></a><code><span><span class="keyword">val</span> each : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>each fn src</code> applies an effectful function <code>fn</code> to all elements in <code>src</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file"><a href="#val-file" class="anchor"></a><code><span><span class="keyword">val</span> file : <span><span class="label">filename</span>:string <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span>string <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>file ~filename len</code> reads at most <code>len</code> bytes of the file <code>filename</code> until the end.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-in_channel"><a href="#val-in_channel" class="anchor"></a><code><span><span class="keyword">val</span> in_channel : <span><span class="optlabel">?close</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="../../../../stdlib/Stdlib/index.html#type-in_channel">in_channel</a> <span class="arrow">&#45;&gt;</span></span> <span>string <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>in_channel ic</code> reads strings from the given <a href="../../../../stdlib/Stdlib/index.html#type-in_channel"><code>in_channel</code></a> <code>ic</code>. If the given <code>ic</code> is not <a href="../../../../stdlib/Stdlib/index.html#val-stdin"><code>stdin</code></a> and <code>?close</code> is <code>true</code> (by default), <a href="#val-dispose"><code>dispose</code></a> closes it properly.</p></div></div><h3 id="consuming-a-source."><a href="#consuming-a-source." class="anchor"></a>Consuming a source.</h3><div class="odoc-spec"><div class="spec value anchored" id="val-next"><a href="#val-next" class="anchor"></a><code><span><span class="keyword">val</span> next : <span><span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span> * <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span>)</span> option</span></span></code></div><div class="spec-doc"><p><code>next src</code> is <code>Some (x, rest)</code> where <code>x</code> is the first element of <code>src</code> and <code>rest</code> is <code>src</code> without <code>x</code>; or <code>None</code>, if <code>src</code> is empty.</p><p><b>NOTE</b>: If <code>rest</code> is produced, it is required to either consume it or manually <a href="#val-dispose" title="dispose">dispose</a> its resources. Not doing so might lead to resource leaks.</p></div></div><h3 id="resource-handling."><a href="#resource-handling." class="anchor"></a>Resource handling.</h3><div class="odoc-spec"><div class="spec value anchored" id="val-dispose"><a href="#val-dispose" class="anchor"></a><code><span><span class="keyword">val</span> dispose : <span><span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>dispose src</code> <b>forces</b> the termination of the source data. This function is useful in situations when a leftover source is produced in <a href="../Stream/index.html#val-run"><code>Stream.run</code></a>.</p><p><b>NOTE</b>: If the source is not already initialized, calling this function will first initialize its state before it is terminated.</p></div></div><h3 id="miou-related-functions."><a href="#miou-related-functions." class="anchor"></a>Miou related functions.</h3><div class="odoc-spec"><div class="spec value anchored" id="val-resource"><a href="#val-resource" class="anchor"></a><code><span><span class="keyword">val</span> resource : <span><span class="label">finally</span>:<span>(<span><span class="type-var">'r</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'r</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'r</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>resource ~finally pull value</code> creates a new resource from a <code>pull</code> function and an initial value. <code>resource</code> uses Miou's ownership mechanism so that if the task consuming the resource is cancelled, the resource is properly released (and <code>finally</code> is executed).</p><p>This also <b>requires</b> the user to <a href="#val-dispose"><code>dispose</code></a> the source at the end of the task, otherwise Miou's rules will be violated.</p><p><b>NOTE</b>: The resource passed to the <code>pull</code> function is <b>physically</b> the same as <code>init</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-task"><a href="#type-task" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a task</span></span><span> = <span><span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="../Bqueue/index.html#type-t">Bqueue.t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Type of tasks which should fill a given bounded-queue.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_task"><a href="#val-with_task" class="anchor"></a><code><span><span class="keyword">val</span> with_task : 
  <span><span class="optlabel">?parallel</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?halt</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-task">task</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>with_task ?halt ~size producer</code> returns a source that is linked to a task <code>producer</code> producing elements of type <code>'a</code>. The transfer of elements between the task and the source consumer is limited in memory by <code>size</code> elements at a time.</p><p>The source is not effective and may potentially block if the shared queue is empty and an attempt is made to consume it (via <a href="#val-next"><code>next</code></a>, for example). The shared queue is automatically closed/halted (depending on <code>?halt</code>, defaults to <code>false</code>) as soon as the producer terminates.</p><p>For more details on the difference between <code>halt</code> and <code>close</code>, please refer to the <a href="../Bqueue/index.html"><code>Bqueue</code></a> module.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_formatter"><a href="#val-with_formatter" class="anchor"></a><code><span><span class="keyword">val</span> with_formatter : 
  <span><span class="optlabel">?halt</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">size</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../../../../stdlib/Stdlib/Format/index.html#type-formatter">Format.formatter</a> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <a href="../index.html#type-source">source</a></span></span></code></div><div class="spec-doc"><p><code>with_formatter ?halt ~size producer</code> is a specialisation of <a href="#val-with_task"><code>with_task</code></a> with a <code>Format.formatter</code>. Everything written in the formatter is transmitted to the consumer.</p></div></div></div></body></html>
